class(pge_bayzips_date$Date)
class(pge_bayzips_date$DATE)
as.Date(DATE, Date)
pge_bayzips_date$DaTE <- as.Date(DATE, Date)
pge_bayzips_date$DATE <- as.Date(DATE, Date)
pge_bayzips_date$DATE <- as.Date(pge_bazips_date$DATE, Date, "%m/%Y")
library(tidyverse)
library(plotly)
pge_bay_chart <-
pge_bayzips_date %>%
ggplot() +
geom_bar(
aes(
x = DATE %>% factor(),
y = TOTALKBTU,
fill = CUSTOMERCLASS
),
stat = "identity",
position = "stack"
) +
labs(
x = "Month",
y = "KBTU",
title = "9 Bay Area Counties Monthly Electric & Gas Usage, 2017-2020",
fill = "Energy Type"
)
pge_bay_chart <-
list(
autotick = FALSE,
ticks = "outside",
tick0 = 0,
dtick = 0.25,
ticklen = 5,
tickwidth = 2,
tickcolor = toRGB("blue")
)
#pge_bay_chart +
#scale_x_discrete(breaks = seq(0,42,2))
pge_bay_chart %>%
ggplotly() %>%
layout(
xaxis = list(fixedrange = T),
yaxis = list(fixedrange = T)
) %>%
config(displayModeBar = F)
library(tidyverse)
years <- 2017:2020
quarters <- 1:4
types <- c("Electric", "Gas")
months <- 1:42
pge_elec_gas <- NULL
for (quarter in quarters){
for (year in years){
for (type in types){
if ((quarter %in% 3:4) & (year %in% 2020)){
next
}
filename <-
paste0(
"PGE_",
year,
"_Q",
quarter,
"_",
type,
"UsageByZip.csv"
)
print(filename)
temp <- read_csv(filename)
if(type %in% "Gas"){
print(temp)
temp <- temp %>%
mutate(TOTALKBTU = 100 * TOTALTHM) %>%
select(-TOTALTHM, -AVERAGETHM)
} else {
temp <- temp %>%
mutate(TOTALKBTU = 3.412 * TOTALKWH) %>%
select(-TOTALKWH, -AVERAGEKWH)
}
pge_elec_gas <- rbind(pge_elec_gas, temp)
}
}
}
pge_res_com <-
filter(
pge_elec_gas,
CUSTOMERCLASS %in%
c(
"Elec- Residential ",
"Gas- Residential",
"Elec- Commercial",
"Gas- Commercial"
)
)
library(tidyverse)
library(sf)
library(tigris)
library(leaflet)
library (dplyr)
ca_counties <- counties("CA", cb = T, progress_bar = F)
st_crs(ca_counties)
projection <- "+proj=utm +zone=10 +ellps=GRS80 +datum=NAD83 +units=ft +no_defs"
ca_counties_transformed <-
ca_counties %>%
st_transform(4326) %>%
st_transform(26910) %>%
st_transform(projection) %>%
st_transform(st_crs(ca_counties))
usa_zips <-
zctas(cb = T, progress_bar = F)
bay_county_names <-
c(
"Alameda",
"Contra Costa",
"Marin",
"Napa",
"San Francisco",
"San Mateo",
"Santa Clara",
"Solano",
"Sonoma"
)
bay_cbgs <-
bay_county_names %>%
map_dfr(function(county) {
block_groups("CA", county, cb = T, progress_bar = F)
})
bay_counties <-
ca_counties %>%
filter(NAME %in% bay_county_names)
bay_zips <-
usa_zips %>%
st_centroid() %>%
.[bay_counties, ] %>%
st_set_geometry(NULL) %>%
left_join(usa_zips %>% select(GEOID10)) %>%
st_as_sf()
colnames(pge_elec_gas)
pge_rc_bayzips <-
pge_elec_gas %>%
filter(CUSTOMERCLASS %in% c("Gas- Residential", "Elec- Residential", "Gas- Commercial", "Elec- Commercial")) %>%
mutate(
ZIPCODE = ZIPCODE %>% as.character()
) %>%
group_by(ZIPCODE, CUSTOMERCLASS, MONTH, YEAR) %>%
summarize(
TOTALKBTU = sum(TOTALKBTU, na.rm = T)
) %>%
right_join(
bay_zips %>% select(GEOID10),
by = c("ZIPCODE" = "GEOID10")
) %>%
ungroup()
class(pge_rc_bayzips$ZIPCODE)
pge_bayzips_date$DATE <- as.Date(pge_bazips_date$DATE, Date, "%m/%Y")
pge_bayzips_date$DATE <- as.Date(pge_bazips_date$DATE)
pge_bayzips_date$DATE <- as.Date(DATE)
pge_bayzips_date <- transform(pge_bayzips_date, Date = as.Date(Date, frac = 1))
library(zoo)
pge_bayzips_date <- transform(pge_bayzips_date, Date = as.Date(Date, frac = 1))
class(pge_bayzips_date$Date)
library(tidyverse)
library(plotly)
pge_bay_chart <-
pge_bayzips_date %>%
ggplot() +
geom_bar(
aes(
x = Date %>% factor(),
y = TOTALKBTU,
fill = CUSTOMERCLASS
),
stat = "identity",
position = "stack"
) +
labs(
x = "Month",
y = "KBTU",
title = "9 Bay Area Counties Monthly Electric & Gas Usage, 2017-2020",
fill = "Energy Type"
)
library(tidyverse)
library(plotly)
library(zoo)
pge_bayzips_date <- transform(pge_bayzips_date, Date = as.Date(Date, frac = 1))
class(pge_bayzips_date$Date)
pge_bay_chart <-
pge_bayzips_date %>%
ggplot() +
geom_bar(
aes(
x = Date %>% factor(),
y = TOTALKBTU,
fill = CUSTOMERCLASS
),
stat = "identity",
position = "stack"
) +
labs(
x = "Month",
y = "KBTU",
title = "9 Bay Area Counties Monthly Electric & Gas Usage, 2017-2020",
fill = "Energy Type"
)
#pge_bay_chart +
#scale_x_discrete(breaks = seq(0,42,2))
pge_bay_chart %>%
ggplotly() %>%
layout(
xaxis = list(fixedrange = T),
yaxis = list(fixedrange = T)
) %>%
config(displayModeBar = F)
library(tidyverse)
library(plotly)
library(zoo)
pge_bayzips_date <- transform(pge_bayzips_date, Date = as.Date(Date, frac = 1))
class(pge_bayzips_date$Date)
pge_bay_chart <-
pge_bayzips_date %>%
ggplot() +
geom_bar(
aes(
x = Date %>% factor(),
y = TOTALKBTU,
fill = CUSTOMERCLASS
),
stat = "identity",
position = "stack"
) +
labs(
x = "Month",
y = "KBTU",
title = "9 Bay Area Counties Monthly Electric & Gas Usage, 2017-2020",
fill = "Energy Type"
)
#pge_bay_chart +
#scale_x_discrete(breaks = seq(0,42,2))
pge_bay_chart %>%
ggplotly() %>%
layout(
xaxis = list(fixedrange = T),
yaxis = list(fixedrange = T)
) %>%
config(displayModeBar = F)
pge_bay_chart <-
pge_bayzips_date %>%
ggplot() +
geom_bar(
aes(
x = Date %>% factor(),
y = TOTALKBTU,
fill = CUSTOMERCLASS
),
stat = "identity",
position = "stack"
) +
labs(
x = "Month",
y = "KBTU",
title = "9 Bay Area Counties Monthly Electric & Gas Usage, 2017-2020",
fill = "Energy Type"
)
pge_bay_chart <-
pge_bayzips_date %>%
ggplot() +
geom_bar(
aes(
x = Date %>% factor(),
y = TOTALKBTU,
fill = CUSTOMERCLASS
),
stat = "identity",
position = "stack"
) +
labs(
x = "Month",
y = "KBTU",
title = "9 Bay Area Counties Monthly Electric & Gas Usage, 2017-2020",
fill = "Energy Type"
)
pge_bay_chart %>%
ggplotly() %>%
layout(
xaxis = list(fixedrange = T),
yaxis = list(fixedrange = T)
) %>%
config(displayModeBar = F)
pge_bay_chart <-
pge_bayzips_date %>%
ggplot() +
geom_bar(
aes(
x = DATE %>% factor(),
y = TOTALKBTU,
fill = CUSTOMERCLASS
),
stat = "identity",
position = "stack"
) +
labs(
x = "Month",
y = "KBTU",
title = "9 Bay Area Counties Monthly Electric & Gas Usage, 2017-2020",
fill = "Energy Type"
)
pge_bay_chart %>%
ggplotly() %>%
layout(
xaxis = list(fixedrange = T),
yaxis = list(fixedrange = T)
) %>%
config(displayModeBar = F)
pge_bay_chart <-
pge_bayzips_date %>%
ggplot() +
geom_bar(
aes(
x = DATE,
y = TOTALKBTU,
fill = CUSTOMERCLASS
),
stat = "identity",
position = "stack"
) +
labs(
x = "Month",
y = "KBTU",
title = "9 Bay Area Counties Monthly Electric & Gas Usage, 2017-2020",
fill = "Energy Type"
)
pge_bay_chart %>%
ggplotly() %>%
layout(
xaxis = list(fixedrange = T),
yaxis = list(fixedrange = T)
) %>%
config(displayModeBar = F)
pge_bay_chart <-
pge_bayzips_date %>%
ggplot() +
geom_bar(
aes(
x = Date,
y = TOTALKBTU,
fill = CUSTOMERCLASS
),
stat = "identity",
position = "stack"
) +
labs(
x = "Month",
y = "KBTU",
title = "9 Bay Area Counties Monthly Electric & Gas Usage, 2017-2020",
fill = "Energy Type"
)
pge_bay_chart %>%
ggplotly() %>%
layout(
xaxis = list(fixedrange = T),
yaxis = list(fixedrange = T)
) %>%
config(displayModeBar = F)
rm(pge_res_com)
View(bay_counties)
pge_rc_baycounties <-
pge_elec_gas %>%
filter(CUSTOMERCLASS %in% c("Gas- Residential", "Elec- Residential", "Gas- Commercial", "Elec- Commercial")) %>%
mutate(
ZIPCODE = ZIPCODE %>% as.character()
) %>%
group_by(ZIPCODE, CUSTOMERCLASS, MONTH, YEAR) %>%
summarize(
TOTALKBTU = sum(TOTALKBTU, na.rm = T)
) %>%
right_join(
bay_counties %>% select(GEOID),
by = c("ZIPCODE" = "GEOID")
) %>%
ungroup()
View(pge_rc_baycounties)
pge_rc_baycounties <-
pge_elec_gas %>%
filter(CUSTOMERCLASS %in% c("Gas- Residential", "Elec- Residential", "Gas- Commercial", "Elec- Commercial")) %>%
mutate(
ZIPCODE = ZIPCODE %>% as.character()
) %>%
group_by(ZIPCODE) %>%
summarize(
TOTALKBTU = sum(TOTALKBTU, na.rm = T)
) %>%
right_join(
bay_counties %>% select(GEOID),
by = c("ZIPCODE" = "GEOID")
) %>%
ungroup()
View(bay_cbgs)
pge_rc_baycounties <-
pge_elec_gas %>%
filter(CUSTOMERCLASS %in% c("Gas- Residential", "Elec- Residential", "Gas- Commercial", "Elec- Commercial")) %>%
mutate(
ZIPCODE = ZIPCODE %>% as.character()
) %>%
group_by(ZIPCODE) %>%
summarize(
TOTALKBTU = sum(TOTALKBTU, na.rm = T)
) %>%
right_join(
bay_cbgs %>% select(GEOID),
by = c("ZIPCODE" = "GEOID")
) %>%
ungroup()
pge_rc_baycounties <-
pge_rc_bayzips %>%
filter(CUSTOMERCLASS %in% c("Gas- Residential", "Elec- Residential", "Gas- Commercial", "Elec- Commercial")) %>%
mutate(
ZIPCODE = ZIPCODE %>% as.character()
) %>%
group_by(ZIPCODE) %>%
summarize(
TOTALKBTU = sum(TOTALKBTU, na.rm = T)
) %>%
right_join(
bay_cbgs %>% select(GEOID),
by = c("ZIPCODE" = "GEOID")
) %>%
ungroup()
pge_rc_baycounties <-
pge_rc_bayzips %>%
right_join(
bay_cbgs %>% select(GEOID),
by = c("ZIPCODE" = "GEOID")
) %>%
rm(pge_rc_baycounties)
View(pge_rc_bayzips)
aggregate(TOTALKBTU~ZIPCODE, pge_rc_bayzips, sum)
View(bay_counties)
pge_rc_counties <-
pge_rc_bayzips %>%
summarize(
ZIPCODE = sum(ZIPCODE, na.rm = T)
)
pge_rc_bycounty <-
pge_rc_bayzips %>%
summarize(
ZIPCODE = sum(ZIPCODE, na.rm = T)
)
pge_rc_bycounty <-
pge_rc_bayzips %>%
group_by(ZIPCODE) %>%
summarize(
ZIPCODE = sum(ZIPCODE, na.rm = T)
)
pge_rc_bycounty <-
pge_rc_bayzips %>%
group_by(ZIPCODE) %>%
summarize(
TOTALKBTU = sum(ZIPCODE, na.rm = T)
)
aggregate(ZIPCODE~TOTALKBTU, pge_rc_bayzips, sum)
aggregate(TOTALKBTU~ZIPCODE, pge_rc_bayzips, sum)
zipcode <- aggregate(TOTALKBTU~ZIPCODE, pge_rc_bayzips, length)
names(zipcode)[2] <- "zipcode"
totalkbtu <- aggregate(TOTALKBTU~ZIPCODE, pge_rc_bayzips, sum)
names(totalkbtu)[2] <- "totalkbtu"
merge(zipcode, totalkbtu)
View(bay_zips)
year <- aggregate(TOTALKBTU~YEAR, pge_rc_bayzips, length)
names(year)[2] <- "year"
totalkbtu <- aggregate(TOTALKBTU~YEAR, pge_rc_bayzips, sum)
names(totalkbtu)[2] <- "totalkbtu"
merge(year, totalkbtu)
pge_rc_bycounty <-
pge_rc_bayzips %>%
group_by(CUSTOMERCLASS, YEAR) %>%
aggregate(TOTALKBTU~YEAR, length) %>%
year <- aggregate(TOTALKBTU~YEAR, pge_rc_bayzips, length)
pge_rc_bycounty <-
pge_rc_bayzips %>%
group_by(CUSTOMERCLASS, YEAR) %>%
aggregate(TOTALKBTU~YEAR, length)
pge_rc_bycounty <-
pge_rc_bayzips %>%
group_by(CUSTOMERCLASS, YEAR)
pge_rc_bayzips <-
pge_elec_gas %>%
filter(CUSTOMERCLASS %in% c("Gas- Residential", "Elec- Residential", "Gas- Commercial", "Elec- Commercial")) %>%
mutate(
ZIPCODE = ZIPCODE %>% as.character()
) %>%
group_by(CUSTOMERCLASS, MONTH, YEAR) %>%
summarize(
TOTALKBTU = sum(TOTALKBTU, na.rm = T)
) %>%
right_join(
bay_zips %>% select(GEOID10),
by = c("ZIPCODE" = "GEOID10")
)
pge_rc_bayzips <-
pge_elec_gas %>%
filter(CUSTOMERCLASS %in% c("Gas- Residential", "Elec- Residential", "Gas- Commercial", "Elec- Commercial")) %>%
mutate(
ZIPCODE = ZIPCODE %>% as.character()
) %>%
group_by(CUSTOMERCLASS, MONTH, YEAR) %>%
summarize(
TOTALKBTU = sum(TOTALKBTU, na.rm = T)
) %>%
right_join(
bay_zips %>% select(GEOID10),
by = c("ZIPCODE" = "GEOID10")
)
